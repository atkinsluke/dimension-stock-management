<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Analytics Dashboard - Dimension Print Services</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3a5f 0%, #2d1b3d 25%, #4a1942 50%, #2d1b3d 75%, #1e3a5f 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            color: white;
            padding: 30px 20px;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .subtitle {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.8;
        }

        .filters-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 0.9rem;
            margin-bottom: 8px;
            opacity: 0.9;
            font-weight: 500;
        }

        input, select {
            padding: 12px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: white;
            transition: all 0.3s ease;
        }

        input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.5);
        }

        input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .quick-filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .quick-filter-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .quick-filter-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .quick-filter-btn.active {
            background: rgba(74, 25, 66, 0.6);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .refresh-btn {
            padding: 12px 30px;
            background: rgba(74, 25, 66, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .refresh-btn:hover {
            background: rgba(74, 25, 66, 0.8);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .stat-label {
            font-size: 0.95rem;
            opacity: 0.8;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 25px;
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .table-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 25px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        th {
            font-weight: 600;
            opacity: 0.9;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .loading {
            text-align: center;
            padding: 60px;
            font-size: 1.3rem;
        }

        .error {
            background: rgba(220, 53, 69, 0.3);
            border: 1px solid rgba(220, 53, 69, 0.5);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Dimension Print Services</h1>
        <p class="subtitle">Stock Analytics Dashboard</p>

        <div class="filters-section">
            <div class="filters-grid">
                <div class="filter-group">
                    <label for="jobNumber">Job Number (Optional)</label>
                    <input type="text" id="jobNumber" placeholder="Enter job number to filter">
                </div>
                <div class="filter-group">
                    <label for="startDate">Start Date</label>
                    <input type="date" id="startDate">
                </div>
                <div class="filter-group">
                    <label for="endDate">End Date</label>
                    <input type="date" id="endDate">
                </div>
            </div>
            
            <div class="quick-filters">
                <button class="quick-filter-btn" onclick="setQuickFilter('today', event)">Today</button>
                <button class="quick-filter-btn" onclick="setQuickFilter('week', event)">This Week</button>
                <button class="quick-filter-btn" onclick="setQuickFilter('month', event)">This Month</button>
                <button class="quick-filter-btn active" onclick="setQuickFilter('all', event)">All Time</button>
            </div>

            <div style="display: flex; gap: 15px; margin-top: 15px; flex-wrap: wrap;">
                <button class="refresh-btn" onclick="loadDashboard()">🔄 Refresh Dashboard</button>
                <button class="refresh-btn" onclick="showDailyList()">📋 Daily List</button>
            </div>
        </div>

        <div id="errorMessage"></div>
        <div id="dashboardContent">
            <div class="loading">Click "Refresh Dashboard" to load data...</div>
        </div>
    </div>

    <script>
        // IMPORTANT: Replace this with your Google Apps Script web app URL for reading data
        const READ_DATA_URL = 'https://script.google.com/macros/s/AKfycby-8x2Z_cNcyMrAohMtZvOHcYK2RNDQfv9q0E45KLzbcSGeJpunR_awAyRULqMGFxUeFw/exec';

        let allData = [];
        let charts = {};

        // Set initial date to today
        document.getElementById('endDate').valueAsDate = new Date();

        function setQuickFilter(period, event) {
            const today = new Date();
            let endDate = new Date();
            let startDate = new Date();

            // Remove active class from all buttons
            document.querySelectorAll('.quick-filter-btn').forEach(btn => btn.classList.remove('active'));
            
            switch(period) {
                case 'today':
                    startDate = new Date(today);
                    endDate = new Date(today);
                    break;
                case 'week':
                    startDate.setDate(today.getDate() - 7);
                    endDate = new Date(today);
                    break;
                case 'month':
                    startDate.setMonth(today.getMonth() - 1);
                    endDate = new Date(today);
                    break;
                case 'all':
                    startDate = new Date('2020-01-01');
                    endDate = new Date('2030-12-31'); // Set far future date for "All Time"
                    break;
            }

            // Add active class to clicked button if event exists
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // If no event (called programmatically), find and activate the button
                const buttons = document.querySelectorAll('.quick-filter-btn');
                buttons.forEach(btn => {
                    if (btn.textContent.toLowerCase().includes(period) || 
                        (period === 'all' && btn.textContent.includes('All Time'))) {
                        btn.classList.add('active');
                    }
                });
            }

            // Format dates as YYYY-MM-DD for the input fields
            const formatDate = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            };

            document.getElementById('startDate').value = formatDate(startDate);
            document.getElementById('endDate').value = formatDate(endDate);
        }

        async function loadDashboard() {
            const errorDiv = document.getElementById('errorMessage');
            const contentDiv = document.getElementById('dashboardContent');
            
            errorDiv.innerHTML = '';
            contentDiv.innerHTML = '<div class="loading">Loading data...</div>';

            console.log('Fetching from:', READ_DATA_URL);

            try {
                const response = await fetch(READ_DATA_URL, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                
                const textResponse = await response.text();
                console.log('Raw response:', textResponse);
                
                let data;
                try {
                    data = JSON.parse(textResponse);
                } catch (parseError) {
                    throw new Error('Failed to parse JSON. Response: ' + textResponse.substring(0, 200));
                }
                
                if (data.error) {
                    throw new Error(data.error);
                }

                if (!data.data || data.data.length === 0) {
                    throw new Error('No data returned from sheet. Make sure your sheet has entries.');
                }

                allData = data.data;
                console.log('Loaded', allData.length, 'rows');
                filterAndDisplayData();

            } catch (error) {
                console.error('Full error:', error);
                errorDiv.innerHTML = `
                    <div class="error">
                        <strong>⚠️ Error Loading Data</strong><br>
                        ${error.message}<br><br>
                        <strong>Check the browser console (F12) for detailed error info.</strong><br><br>
                        Common fixes:<br>
                        1. Make sure the URL ends with /exec<br>
                        2. Make sure you deployed with "New version" after adding doGet<br>
                        3. Try pasting the URL directly in your browser - you should see JSON data
                    </div>
                `;
                contentDiv.innerHTML = '';
            }
        }

        // Helper function to parse UK format dates (DD/MM/YYYY HH:MM:SS)
        function parseUKDate(dateStr) {
            if (!dateStr) return new Date();
            
            // If it's already a proper ISO date, use it
            if (dateStr.includes('T') || dateStr.includes('-')) {
                return new Date(dateStr);
            }
            
            // Parse UK format: DD/MM/YYYY HH:MM:SS
            const parts = dateStr.split(/[\s/:]+/);
            if (parts.length >= 3) {
                const day = parseInt(parts[0]);
                const month = parseInt(parts[1]) - 1; // Month is 0-indexed
                const year = parseInt(parts[2]);
                const hour = parts.length > 3 ? parseInt(parts[3]) : 0;
                const minute = parts.length > 4 ? parseInt(parts[4]) : 0;
                const second = parts.length > 5 ? parseInt(parts[5]) : 0;
                
                return new Date(year, month, day, hour, minute, second);
            }
            
            return new Date(dateStr);
        }

        function filterAndDisplayData() {
            const jobNumber = document.getElementById('jobNumber').value.trim().toLowerCase();
            const startDateValue = document.getElementById('startDate').value;
            const endDateValue = document.getElementById('endDate').value;
            
            console.log('Start date input value:', startDateValue);
            console.log('End date input value:', endDateValue);
            
            const startDate = new Date(startDateValue);
            const endDate = new Date(endDateValue);
            endDate.setHours(23, 59, 59);

            console.log('Start date object:', startDate);
            console.log('End date object:', endDate);
            console.log('Job number filter:', jobNumber);
            console.log('Total data rows:', allData.length);

            // Filter data
            let filteredData = allData.filter(row => {
                const rowDate = parseUKDate(row.datetime);
                const matchesDate = rowDate >= startDate && rowDate <= endDate;
                const matchesJob = !jobNumber || String(row.projectnumber).toLowerCase().includes(jobNumber);
                
                if (!matchesDate) {
                    console.log('Filtered OUT - Row date:', rowDate.toLocaleString(), 'Range:', startDate.toLocaleString(), 'to', endDate.toLocaleString());
                }
                
                return matchesDate && matchesJob;
            });

            console.log('Filtered data count:', filteredData.length);
            
            if (filteredData.length === 0) {
                console.log('NO DATA MATCHED THE FILTER');
                console.log('Sample row date for comparison:', allData[0] ? parseUKDate(allData[0].datetime) : 'no data');
            }
            
            displayDashboard(filteredData);
        }

        function displayDashboard(data) {
            const contentDiv = document.getElementById('dashboardContent');
            
            if (data.length === 0) {
                contentDiv.innerHTML = '<div class="loading">No data found for selected filters.</div>';
                return;
            }

            // Calculate stats
            const totalEntries = data.length;
            const totalQuantity = data.reduce((sum, row) => sum + parseFloat(row.quantity || 0), 0);
            
            // Most used material (by description)
            const materialCounts = {};
            data.forEach(row => {
                const desc = row.materialdescription || row.inventoryid;
                materialCounts[desc] = (materialCounts[desc] || 0) + 1;
            });
            const mostUsedMaterial = Object.keys(materialCounts).reduce((a, b) => 
                materialCounts[a] > materialCounts[b] ? a : b, 'N/A');

            // Most active operator
            const operatorCounts = {};
            data.forEach(row => {
                operatorCounts[row.operatorname] = (operatorCounts[row.operatorname] || 0) + 1;
            });
            const mostActiveOperator = Object.keys(operatorCounts).reduce((a, b) => 
                operatorCounts[a] > operatorCounts[b] ? a : b, 'N/A');

            // Entry method breakdown
            const entryMethods = {};
            data.forEach(row => {
                entryMethods[row.entrymethod] = (entryMethods[row.entrymethod] || 0) + 1;
            });

            // Material groups
            const groupCounts = {};
            data.forEach(row => {
                // Extract group from material description or inventory ID
                let group = 'Other';
                if (row.inventoryid.includes('ADH')) group = 'Lamination';
                else if (row.inventoryid.includes('FLM')) group = 'Films & Paper';
                else if (row.inventoryid.includes('SAV')) group = 'Self Adhesive';
                else if (row.inventoryid.includes('ACR')) group = 'Acrylic';
                else if (row.inventoryid.includes('COR')) group = 'Corrugated & Xanita';
                else if (row.inventoryid.includes('DB')) group = 'Solid Board';
                else if (row.inventoryid.includes('KON')) group = 'Konica Materials';
                else if (row.inventoryid.includes('PLA')) group = 'Other Plastics';
                
                groupCounts[group] = (groupCounts[group] || 0) + 1;
            });

            contentDiv.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${totalEntries}</div>
                        <div class="stat-label">Total Entries</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${totalQuantity.toFixed(1)}</div>
                        <div class="stat-label">Total Quantity</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${mostUsedMaterial}</div>
                        <div class="stat-label">Most Used Material</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${mostActiveOperator}</div>
                        <div class="stat-label">Most Active Operator</div>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-title">Materials by Group</div>
                        <div class="chart-container">
                            <canvas id="groupChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">Entry Method</div>
                        <div class="chart-container">
                            <canvas id="methodChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-title">Top 10 Materials Used</div>
                    <div class="chart-container" style="height: 400px;">
                        <canvas id="topMaterialsChart"></canvas>
                    </div>
                </div>

                <div class="table-card">
                    <div class="chart-title">Recent Entries</div>
                    <table>
                        <thead>
                            <tr>
                                <th>Date/Time</th>
                                <th>Material</th>
                                <th>Quantity</th>
                                <th>Project</th>
                                <th>Operator</th>
                            </tr>
                        </thead>
                        <tbody id="recentEntriesTable"></tbody>
                    </table>
                </div>

                <div class="table-card">
                    <div class="chart-title">Operator Leaderboard</div>
                    <table>
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Operator</th>
                                <th>Entries</th>
                                <th>Total Quantity</th>
                            </tr>
                        </thead>
                        <tbody id="operatorTable"></tbody>
                    </table>
                </div>
            `;

            // Create charts
            createGroupChart(groupCounts);
            createMethodChart(entryMethods);
            createTopMaterialsChart(materialCounts);
            fillOperatorTable(data);
            fillRecentEntriesTable(data);
        }

        function createGroupChart(groupCounts) {
            const ctx = document.getElementById('groupChart');
            if (charts.groupChart) charts.groupChart.destroy();
            
            charts.groupChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(groupCounts),
                    datasets: [{
                        data: Object.values(groupCounts),
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 206, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)',
                            'rgba(153, 102, 255, 0.8)',
                            'rgba(255, 159, 64, 0.8)',
                            'rgba(199, 199, 199, 0.8)',
                            'rgba(83, 102, 255, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: 'white' }
                        }
                    }
                }
            });
        }

        function createMethodChart(entryMethods) {
            const ctx = document.getElementById('methodChart');
            if (charts.methodChart) charts.methodChart.destroy();
            
            charts.methodChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(entryMethods),
                    datasets: [{
                        data: Object.values(entryMethods),
                        backgroundColor: [
                            'rgba(74, 25, 66, 0.8)',
                            'rgba(30, 58, 95, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: 'white' }
                        }
                    }
                }
            });
        }

        function createTopMaterialsChart(materialCounts) {
            const ctx = document.getElementById('topMaterialsChart');
            if (charts.topMaterialsChart) charts.topMaterialsChart.destroy();
            
            const sorted = Object.entries(materialCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            charts.topMaterialsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sorted.map(item => item[0]),
                    datasets: [{
                        label: 'Usage Count',
                        data: sorted.map(item => item[1]),
                        backgroundColor: 'rgba(74, 25, 66, 0.8)',
                        borderColor: 'rgba(255, 255, 255, 0.5)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }

        function fillOperatorTable(data) {
            const operatorStats = {};
            data.forEach(row => {
                if (!operatorStats[row.operatorname]) {
                    operatorStats[row.operatorname] = { count: 0, quantity: 0 };
                }
                operatorStats[row.operatorname].count++;
                operatorStats[row.operatorname].quantity += parseFloat(row.quantity || 0);
            });

            const sorted = Object.entries(operatorStats)
                .sort((a, b) => b[1].count - a[1].count);

            const tbody = document.getElementById('operatorTable');
            tbody.innerHTML = sorted.map((item, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${item[0]}</td>
                    <td>${item[1].count}</td>
                    <td>${item[1].quantity.toFixed(1)}</td>
                </tr>
            `).join('');
        }

        function fillRecentEntriesTable(data) {
            const sorted = [...data].sort((a, b) => 
                parseUKDate(b.datetime) - parseUKDate(a.datetime)
            ).slice(0, 20);

            const tbody = document.getElementById('recentEntriesTable');
            tbody.innerHTML = sorted.map(row => `
                <tr>
                    <td>${parseUKDate(row.datetime).toLocaleString('en-GB')}</td>
                    <td>${row.materialdescription || row.inventoryid}</td>
                    <td>${row.quantity}</td>
                    <td>${row.projectnumber}</td>
                    <td>${row.operatorname}</td>
                </tr>
            `).join('');
        }

        function showDailyList() {
            const startDate = new Date(document.getElementById('startDate').value);
            const jobNumber = document.getElementById('jobNumber').value.trim().toLowerCase();
            
            if (!allData || allData.length === 0) {
                alert('Please load data first by clicking "Refresh Dashboard"');
                return;
            }

            console.log('Looking for entries on:', startDate.toLocaleDateString());

            // Filter for specific day - compare just the date parts
            let filteredData = allData.filter(row => {
                const rowDate = parseUKDate(row.datetime);
                
                // Compare year, month, and day only (ignore time)
                const sameYear = rowDate.getFullYear() === startDate.getFullYear();
                const sameMonth = rowDate.getMonth() === startDate.getMonth();
                const sameDay = rowDate.getDate() === startDate.getDate();
                
                const matchesDate = sameYear && sameMonth && sameDay;
                const matchesJob = !jobNumber || String(row.projectnumber).toLowerCase().includes(jobNumber);
                
                console.log('Row date:', rowDate.toLocaleString(), 'Matches:', matchesDate);
                
                return matchesDate && matchesJob;
            });

            console.log('Found', filteredData.length, 'entries for this day');

            const contentDiv = document.getElementById('dashboardContent');

            if (filteredData.length === 0) {
                contentDiv.innerHTML = `
                    <div class="loading">
                        No entries found for ${startDate.toLocaleDateString()}
                        ${jobNumber ? ` with job number "${jobNumber}"` : ''}
                    </div>
                `;
                return;
            }

            // Sort by time
            filteredData.sort((a, b) => new Date(a.datetime) - new Date(b.datetime));

            const totalQuantity = filteredData.reduce((sum, row) => sum + parseFloat(row.quantity || 0), 0);

            contentDiv.innerHTML = `
                <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="stat-value">${startDate.toLocaleDateString('en-GB')}</div>
                        <div class="stat-label">Selected Date</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${filteredData.length}</div>
                        <div class="stat-label">Total Entries</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${totalQuantity.toFixed(1)}</div>
                        <div class="stat-label">Total Quantity</div>
                    </div>
                </div>

                <div class="table-card">
                    <div class="chart-title">Daily Activity Log - ${startDate.toLocaleDateString('en-GB')}</div>
                    <table>
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Material</th>
                                <th>Stock Code</th>
                                <th>Quantity</th>
                                <th>Project</th>
                                <th>Operator</th>
                                <th>Method</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredData.map(row => `
                                <tr>
                                    <td>${parseUKDate(row.datetime).toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' })}</td>
                                    <td>${row.materialdescription || row.inventoryid}</td>
                                    <td>${row.inventoryid}</td>
                                    <td>${row.quantity}</td>
                                    <td>${row.projectnumber}</td>
                                    <td>${row.operatorname}</td>
                                    <td>${row.entrymethod}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="refresh-btn" onclick="loadDashboard()">← Back to Dashboard</button>
                </div>
            `;
        }

        // Set default date range to all time
        setQuickFilter('all');
    </script>
</body>
</html>
